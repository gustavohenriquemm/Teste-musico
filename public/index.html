<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda de Hinos</title>
<link rel="stylesheet" href="home.css">
<link rel="apple-touch-icon" href="img/pql.png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#6a1b9a">
</head>
<body>
<section class="central">

    <!-- Link para o formul√°rio -->
    <a class="Pagina001" href="Formulario.html">P√°gina 2</a>

    <!-- Calend√°rio -->
    <div class="calendar">
        <header>
            <button id="prev">&#9664;</button>
            <h2 id="monthYear"></h2>
            <button id="next">&#9654;</button>
        </header>
        <table>
            <thead>
                <tr>
                    <th>Dom</th>
                    <th>Seg</th>
                    <th>Ter</th>
                    <th>Qua</th>
                    <th>Qui</th>
                    <th>Sex</th>
                    <th>S√°b</th>
                </tr>
            </thead>
            <tbody id="calendarBody"></tbody>
        </table>
    </div> 
    <div class="central_buton_lado">
        <button class="carousel-btn left" id="btnPrev">&#9664;</button>
        <button class="carousel-btn right" id="btnNext">&#9654;</button>
    </div>
    <!-- Carrossel de hinos -->
    <div class="carousel-container">
      
        <div class="cards_container" id="cardsHinos"></div>
       
    </div>

    <!-- Bot√£o para limpar hinos -->
    <div class="container-botao">
        <button id="limparTabela">Limpar Tabela</button>
    </div>

</section>

<script>
// ---------------- CARDS DE HINOS ----------------
let currentIndex = 0;

function atualizarCarrossel() {
    const cards = document.querySelectorAll(".card");
    const totalCards = cards.length;
    const container = document.querySelector(".cards_container");

    // move a lista inteira para mostrar s√≥ 1 card
    container.style.transform = `translateX(-${currentIndex * 100}%)`;
}

// Bot√µes
btnPrev.addEventListener("click", () => {
    const cards = document.querySelectorAll(".card");
    if (cards.length === 0) return;
    currentIndex = (currentIndex - 1 + cards.length) % cards.length;
    atualizarCarrossel();
});

btnNext.addEventListener("click", () => {
    const cards = document.querySelectorAll(".card");
    if (cards.length === 0) return;
    currentIndex = (currentIndex + 1) % cards.length;
    atualizarCarrossel();
});

// Atualizar depois que carregar os hinos
async function carregarHinos() {
    try {
        const res = await fetch('/api/hino');
        const hinos = await res.json();
        const container = document.getElementById("cardsHinos");
        container.innerHTML = "";

        hinos.forEach((hino, index) => {
            let dataFormatada = hino.data;
            if (dataFormatada.includes("-")) {
                const [ano, mes, dia] = hino.data.split("-");
                dataFormatada = `${dia}/${mes}/${ano}`;
            }

            const card = document.createElement("div");
            card.classList.add("card");

            const grupoClass = `grupo_${hino.grupo.toLowerCase().replace(/\s/g, "_")}`;
            card.classList.add(grupoClass);

            card.innerHTML = `
                <button class="delete-btn" onclick="deletarHino(${index})">üóë</button>
                <h3 class="Card_grupo">Grupo: ${hino.grupo}</h3>
                <p class="Card_data"><strong>Data do Culto:</strong> ${dataFormatada}</p>
                <p class="Card_tipo"><strong>Tipo do Culto:</strong> ${hino.tipo || 'Culto de Louvor'}</p>
                <p class="Card_hino"><strong>Nome do Hino:</strong> ${hino.nome}</p>
                <p class="Card_tom"><strong>Tom:</strong> ${hino.tom || 'C Maior'}</p>
                <p class="Card_atentem"><strong>Atentem-se:</strong> ${hino.atentem || 'Nenhum'}</p>
                <a href="${hino.link}" class="Card_link" target="_blank">Assistir</a>
            `;
            container.appendChild(card);
        });

        currentIndex = 0;
        atualizarCarrossel();

    } catch (err) {
        console.error("Erro ao carregar hinos:", err);
    }
}


carregarHinos();

// Limpar todos os hinos
document.getElementById("limparTabela").addEventListener("click", async () => {
    try {
        await fetch('/api/hino', { method: 'DELETE' });
        carregarHinos();
        alert("Cards de hinos limpos com sucesso!");
    } catch (err) {
        console.error(err);
        alert("Erro ao limpar cards!");
    }
});

// Deletar hino individual
async function deletarHino(index) {
    if (!confirm("Deseja realmente excluir este hino?")) return;
    try {
        const res = await fetch(`/api/hino/${index}`, { method: 'DELETE' });
        if (res.ok) {
            alert("‚úÖ Hino removido!");
            carregarHinos();
        } else {
            alert("‚ùå Erro ao remover hino!");
        }
    } catch (err) {
        console.error(err);
        alert("‚ùå Erro na conex√£o ao remover hino!");
    }
}

// ----------- CALEND√ÅRIO -----------
const monthYear = document.getElementById("monthYear");
const calendarBody = document.getElementById("calendarBody");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");
let currentDate = new Date();

function renderCalendar(date) {
    const year = date.getFullYear();
    const month = date.getMonth();
    const months = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
    monthYear.textContent = `${months[month]} ${year}`;

    const firstDay = new Date(year, month, 1).getDay();
    const lastDate = new Date(year, month + 1, 0).getDate();

    calendarBody.innerHTML = "";
    let row = document.createElement("tr");

    for(let i = 0; i < firstDay; i++) row.appendChild(document.createElement("td"));

    for(let day = 1; day <= lastDate; day++){
        const cell = document.createElement("td");
        cell.textContent = day;

        const today = new Date();
        if(day === today.getDate() && month === today.getMonth() && year === today.getFullYear()){
            cell.classList.add("today");
        }

        row.appendChild(cell);

        if((firstDay + day) % 7 === 0){
            calendarBody.appendChild(row);
            row = document.createElement("tr");
        }
    }

    if(row.children.length > 0) calendarBody.appendChild(row);
}

prevBtn.addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar(currentDate);
});

nextBtn.addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar(currentDate);
});

renderCalendar(currentDate);

// ----------- CONTROLES DO CARROSSEL -----------
const cardsContainer = document.getElementById("cardsHinos");
const btnPrev = document.getElementById("btnPrev");
const btnNext = document.getElementById("btnNext");

btnPrev.addEventListener("click", () => {
    cardsContainer.scrollBy({ left: -300, behavior: "smooth" });
});
btnNext.addEventListener("click", () => {
    cardsContainer.scrollBy({ left: 300, behavior: "smooth" });
});

</script>


</body>
</html>

