
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda de Hinos</title>
<link rel="stylesheet" href="home.css">
<!-- √çcone para iOS -->
<link rel="apple-touch-icon" href="img/pql.png">

<!-- Manifest para Android e outros navegadores -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#6a1b9a">
</head>
<body>
<section class="central">

    <!-- Link para o formul√°rio -->
    <a class="Pagina001" href="Formulario.html">P√°gina 2</a>

    <!-- Calend√°rio -->
    <div class="calendar">
        <header>
            <button id="prev">&#9664;</button>
            <h2 id="monthYear"></h2>
            <button id="next">&#9654;</button>
        </header>
        <table>
            <thead>
                <tr>
                    <th>Dom</th>
                    <th>Seg</th>
                    <th>Ter</th>
                    <th>Qua</th>
                    <th>Qui</th>
                    <th>Sex</th>
                    <th>S√°b</th>
                </tr>
            </thead>
            <tbody id="calendarBody"></tbody>
        </table>
    </div> 

    <!-- Tabela de hinos -->
    <div> 

        
   
    <<!-- Container de cards com setas -->
            <div class="carousel-container">
                <button class="carousel-btn left" id="btnPrev">&#9664;</button>
                
                <div class="cards_container" id="cardsHinos"></div>
                
                <button class="carousel-btn right" id="btnNext">&#9654;</button>
            </div>

    
   <div class="container-botao">
  <button id="limparTabela">Limpar Tabela</button>
</div>


</section>

<script>
// ---------------- CARDS DE HINOS ----------------
const btnLimpar = document.getElementById("limparTabela");

// Fun√ß√£o para carregar hinos da API
async function carregarHinos() {
    try {
        const res = await fetch('/api/hino');
        const hinos = await res.json();
        const container = document.getElementById("cardsHinos");
        container.innerHTML = "";

        hinos.forEach(hino => {
            // Formatar data
            let dataFormatada = hino.data;
            if (dataFormatada.includes("-")) {
                const [ano, mes, dia] = hino.data.split("-");
                dataFormatada = `${dia}/${mes}/${ano}`;
            }

            const card = document.createElement("div");
            card.classList.add("card");

            // Classe espec√≠fica por grupo
            const grupoClass = `grupo_${hino.grupo.toLowerCase().replace(/\s/g, "_")}`;
            card.classList.add(grupoClass);

            card.innerHTML = `
                <button class="delete-btn" onclick="deletarHino(${hinos.indexOf(hino)})">üóë</button>
                <h3 class="Card_grupo">Grupo: ${hino.grupo}</h3>
                <p class="Card_data"><strong>Data do Culto:</strong> ${dataFormatada}</p>
                <p class="Card_tipo"><strong>Tipo do Culto:</strong> ${hino.tipo || 'Culto de Louvor'}</p>
                <p class="Card_hino"><strong>Nome do Hino:</strong> ${hino.nome}</p>
                <p class="Card_tom"><strong>Tom:</strong> ${hino.tom || 'C Maior'}</p>
                <p class="Card_atentem"><strong>Atentem-se:</strong> ${hino.atentem || 'Nenhum'}</p>
                <a href="${hino.link}" class="Card_link" target="_blank">Assistir</a>
            `;


            container.appendChild(card);
        });

    } catch (err) {
        console.error(err);
    }
}

// Carrega os cards ao iniciar
carregarHinos();

// Limpar cards
document.getElementById("limparTabela").addEventListener("click", async () => {
    try {
        await fetch('/api/hino', { method: 'DELETE' });
        carregarHinos();
        alert("Cards de hinos limpos com sucesso!");
    } catch (err) {
        console.error(err);
        alert("Erro ao limpar cards!");
    }
});



// Chama ao iniciar
carregarHinos();

// Limpar cards via API
btnLimpar.addEventListener("click", async () => {
    try {
        await fetch('/api/hino', { method: 'DELETE' });
        carregarHinos();
        alert("Cards de hinos limpos com sucesso!");
    } catch (err) {
        console.error(err);
        alert("Erro ao limpar cards!");
    }
});

// API de hinos - DELETE individual
app.delete('/api/hino/:index', (req, res) => {
    try {
        const { index } = req.params;
        const dataFile = fs.readFileSync(hinosFilePath, 'utf-8');
        let hinos = JSON.parse(dataFile);

        if (index < 0 || index >= hinos.length) {
            return res.status(404).json({ message: "Hino n√£o encontrado." });
        }

        hinos.splice(index, 1); // remove s√≥ o escolhido
        fs.writeFileSync(hinosFilePath, JSON.stringify(hinos, null, 2));

        res.json({ message: "Hino removido com sucesso!" });
    } catch (err) {
        res.status(500).json({ message: "Erro ao remover hino." });
    }
});

// Fun√ß√£o para deletar hino individual
async function deletarHino(index) {
    if (!confirm("Deseja realmente excluir este hino?")) return;

    try {
        const res = await fetch(`/api/hino/${index}`, { method: 'DELETE' });
        if (res.ok) {
            alert("‚úÖ Hino removido!");
            carregarHinos(); // recarrega os cards
        } else {
            alert("‚ùå Erro ao remover hino!");
        }
    } catch (err) {
        console.error(err);
        alert("‚ùå Erro na conex√£o ao remover hino!");
    }
}



// ---------------- CALEND√ÅRIO ----------------
const monthYear = document.getElementById("monthYear");
const calendarBody = document.getElementById("calendarBody");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");
let currentDate = new Date();

function renderCalendar(date) {
    const year = date.getFullYear();
    const month = date.getMonth();
    const months = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
    monthYear.textContent = `${months[month]} ${year}`;

    const firstDay = new Date(year, month, 1).getDay();
    const lastDate = new Date(year, month + 1, 0).getDate();

    calendarBody.innerHTML = "";
    let row = document.createElement("tr");

    for(let i = 0; i < firstDay; i++) row.appendChild(document.createElement("td"));

    for(let day = 1; day <= lastDate; day++){
        const cell = document.createElement("td");
        cell.textContent = day;

        const today = new Date();
        if(day === today.getDate() && month === today.getMonth() && year === today.getFullYear()){
            cell.classList.add("today");
        }

        row.appendChild(cell);

        if((firstDay + day) % 7 === 0){
            calendarBody.appendChild(row);
            row = document.createElement("tr");
        }
    }

    if(row.children.length > 0) calendarBody.appendChild(row);
}

prevBtn.addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar(currentDate);
});

nextBtn.addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar(currentDate);
});

renderCalendar(currentDate);

// ---------------- FORMUL√ÅRIO ----------------
const form = document.getElementById("hinoForm");
if(form){
    form.addEventListener("submit", async function(e) {
        e.preventDefault();

        const grupo = document.getElementById("grupo").value;
        const dataCulto = document.getElementById("dataCulto").value;
        const hino = document.getElementById("hino").value;
        const link = document.getElementById("link").value;
        const tipo = document.getElementById("tipo")?.value || 'Culto de Louvor';
        const tom = document.getElementById("tom")?.value || 'C Maior';
        const atentem = document.getElementById("atentem")?.value || '';

        try {
            const res = await fetch('/api/hino', {   
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ grupo, data: dataCulto, nome: hino, link, tipo, tom, atentem })
            });

            if (res.ok) {
                alert("‚úÖ Hino enviado com sucesso!");
                this.reset();
                carregarHinos(); // atualiza cards ap√≥s envio
            } else {
                alert("‚ùå Erro ao enviar hino!");
            }
        } catch (err) {
            console.error(err);
            alert("‚ùå Erro ao enviar hino!");
        }
    });
}


// ----------- CONTROLES DO CARROSSEL -----------
const cardsContainer = document.getElementById("cardsHinos");
const btnPrev = document.getElementById("btnPrev");
const btnNext = document.getElementById("btnNext");

btnPrev.addEventListener("click", () => {
    cardsContainer.scrollBy({ left: -300, behavior: "smooth" });
});
btnNext.addEventListener("click", () => {
    cardsContainer.scrollBy({ left: 300, behavior: "smooth" });
});

</script>


</body>
</html>

