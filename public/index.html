<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda de Hinos</title>
  <link rel="stylesheet" href="home.css">
  <link rel="apple-touch-icon" href="img/pql.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6a1b9a">
</head>
<body>
  <section class="central">

    <!-- Link para o formul√°rio -->
    <a class="Pagina001" href="Formulario.html">P√°gina 2</a>

    <!-- Calend√°rio -->
    <div class="calendar">
        <header>
          <button id="prev">&#9664;</button>
          <h2 id="monthYear"></h2>
          <button id="next">&#9654;</button>
        </header>
        <table>
          <thead>
            <tr>
              <th>Dom</th>
              <th>Seg</th>
              <th>Ter</th>
              <th>Qua</th>
              <th>Qui</th>
              <th>Sex</th>
              <th>S√°b</th>
            </tr>
          </thead>
          <tbody id="calendarBody"></tbody>
        </table>
      </div>


    <!-- Bot√µes laterais -->
    <div class="central_buton_lado">
      <button class="carousel-btn left" id="btnPrev">&#9664;</button>
      <button class="carousel-btn right" id="btnNext">&#9654;</button>
    </div>

    <!-- Carrossel de hinos -->
    <div class="carousel-container">
      <div class="cards_container" id="cardsHinos"></div>
    </div>

    <!-- Bot√£o para limpar hinos -->
    <div class="container-botao">
      <button id="limparTabela">Limpar Tabela</button>
    </div>

    <!-- Modal de Edi√ß√£o -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>Editar Hino</h2>
    <form id="editForm">
      <label>Grupo:</label>
      <input type="text" name="grupo" required>
      
      <label>Data:</label>
      <input type="date" name="data" required>
      
      <label>Nome:</label>
      <input type="text" name="nome" required>
      
      <label>Link:</label>
      <input type="url" name="link">
      
      <label>Tom:</label>
      <input type="text" name="tom">
      
      <label>Atentem-se:</label>
      <input type="text" name="atentem">
      
      <button type="submit">Salvar Altera√ß√µes</button>
    </form>
  </div>
</div>

  </section>

  <script>
// ---------------- CARDS DE HINOS ----------------
let currentIndex = 0;
let hinoAtualIndex = null; // √≠ndice do hino que est√° sendo editado

async function carregarHinos() {
  try {
    const res = await fetch('/api/hino');
    const hinos = await res.json();
    const container = document.getElementById("cardsHinos");
    container.innerHTML = "";

    // Agrupa os hinos por data
    const hinosPorData = {};
    hinos.forEach((hino, index) => {
      const dataFormatada = hino.data; // ajuste conforme o formato da data
      if (!hinosPorData[dataFormatada]) hinosPorData[dataFormatada] = [];
      hinosPorData[dataFormatada].push({ ...hino, index });
    });

    // Cria o container de datas (colunas)
    const datasContainer = document.createElement("div");
    datasContainer.classList.add("datas_container");

    Object.keys(hinosPorData).forEach(data => {
      // Bloco da data (coluna)
      const blocoData = document.createElement("div");
      blocoData.classList.add("grupo-data");

      // T√≠tulo da data
      const titulo = document.createElement("h2");
      titulo.classList.add("titulo-data");
      titulo.textContent = data;
      blocoData.appendChild(titulo);

      // Cards da data
      const cardsWrapper = document.createElement("div");
      cardsWrapper.classList.add("cards_wrapper");

      hinosPorData[data].forEach(hino => {
        // Cria√ß√£o do card
        const card = document.createElement("div");
        card.classList.add("card");
        card.innerHTML = `
          <div class="edit-btn" onclick="abrirModalEdicao(${hino.index})">‚úèÔ∏è</div>
          <div class="delete-btn" onclick="deletarHino(${hino.index})">üóëÔ∏è</div>
          <h3>Grupo: ${hino.grupo}</h3>
          <p><strong>Nome do Hino:</strong> ${hino.nome}</p>
          <p><strong>Tom:</strong> ${hino.tom}</p>
          <p><strong>Atentem-se:</strong> ${hino.atentem}</p>
          <a class="Card_link" href="${hino.link}" target="_blank">Assistir</a>
        `;
        cardsWrapper.appendChild(card);
      });

      blocoData.appendChild(cardsWrapper);
      datasContainer.appendChild(blocoData);
    });

    container.appendChild(datasContainer);

    currentIndex = 0;
    atualizarCarrossel();

  } catch (err) {
    console.error("Erro ao carregar hinos:", err);
  }
}

carregarHinos();

// Atualiza posi√ß√£o do carrossel
function atualizarCarrossel() {
  const container = document.querySelector(".cards_container");
  container.style.transform = `translateX(-${currentIndex * 100}%)`;
}

// Limpar todos os hinos
document.getElementById("limparTabela").addEventListener("click", async () => {
  try {
    await fetch('/api/hino', { method: 'DELETE' });
    carregarHinos();
    alert("Cards de hinos limpos com sucesso!");
  } catch (err) {
    console.error(err);
    alert("Erro ao limpar cards!");
  }
});

// Deletar hino individual
async function deletarHino(index) {
  if (!confirm("Deseja realmente excluir este hino?")) return;
  try {
    const res = await fetch(`/api/hino/${index}`, { method: 'DELETE' });
    if (res.ok) {
      alert("‚úÖ Hino removido!");
      carregarHinos();
    } else {
      alert("‚ùå Erro ao remover hino!");
    }
  } catch (err) {
    console.error(err);
    alert("‚ùå Erro na conex√£o ao remover hino!");
  }
}

// ----------- MODAL DE EDI√á√ÉO -----------
const editModal = document.getElementById("editModal");
const editForm = document.getElementById("editForm");
const closeBtn = document.querySelector(".close-btn");

function abrirModalEdicao(index) {
  hinoAtualIndex = index;
  fetch('/api/hino')
    .then(res => res.json())
    .then(hinos => {
      const hino = hinos[index];
      if (!hino) return alert("Hino n√£o encontrado!");

      // Preenche o formul√°rio
      editForm.grupo.value = hino.grupo || '';
      editForm.data.value = hino.data || '';
      editForm.nome.value = hino.nome || '';
      editForm.link.value = hino.link || '';
      editForm.tom.value = hino.tom || '';
      editForm.atentem.value = hino.atentem || '';

      // Mostra o modal
      editModal.style.display = "block";
    });
}

// Fecha o modal
closeBtn.onclick = () => editModal.style.display = "none";
window.onclick = (event) => {
  if (event.target == editModal) editModal.style.display = "none";
}

// Salvar altera√ß√µes do modal
editForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const dadosAtualizados = {
    grupo: editForm.grupo.value,
    data: editForm.data.value,
    nome: editForm.nome.value,
    link: editForm.link.value,
    tom: editForm.tom.value,
    atentem: editForm.atentem.value
  };

  fetch(`/api/hino/${hinoAtualIndex}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(dadosAtualizados)
  })
  .then(res => {
    if(res.ok){
      alert("Hino atualizado com sucesso!");
      carregarHinos();
      editModal.style.display = "none";
    } else {
      alert("Erro ao atualizar hino!");
    }
  })
  .catch(err => {
    console.error(err);
    alert("Erro na conex√£o ao atualizar hino!");
  });
});

// ----------- CALEND√ÅRIO -----------
// (seu c√≥digo do calend√°rio permanece igual)
const monthYear = document.getElementById("monthYear");
const calendarBody = document.getElementById("calendarBody");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");
let currentDate = new Date();

function renderCalendar(date) {
  const year = date.getFullYear();
  const month = date.getMonth();
  const months = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
  monthYear.textContent = `${months[month]} ${year}`;

  const firstDay = new Date(year, month, 1).getDay();
  const lastDate = new Date(year, month + 1, 0).getDate();

  calendarBody.innerHTML = "";
  let row = document.createElement("tr");

  for(let i = 0; i < firstDay; i++) row.appendChild(document.createElement("td"));

  for(let day = 1; day <= lastDate; day++){
    const cell = document.createElement("td");
    cell.textContent = day;

    const today = new Date();
    if(day === today.getDate() && month === today.getMonth() && year === today.getFullYear()){
      cell.classList.add("today");
    }

    row.appendChild(cell);

    if((firstDay + day) % 7 === 0){
      calendarBody.appendChild(row);
      row = document.createElement("tr");
    }
  }

  if(row.children.length > 0) calendarBody.appendChild(row);
}
prevBtn.addEventListener("click", () => {
  currentDate.setMonth(currentDate.getMonth() - 1);
  renderCalendar(currentDate);
});
nextBtn.addEventListener("click", () => {
  currentDate.setMonth(currentDate.getMonth() + 1);
  renderCalendar(currentDate);
});
renderCalendar(currentDate);

// ----------- CONTROLES DO CARROSSEL -----------
const btnPrev = document.getElementById("btnPrev");
const btnNext = document.getElementById("btnNext");

btnPrev.addEventListener("click", () => {
  const cards = document.querySelectorAll(".card");
  if (cards.length === 0) return;
  currentIndex = (currentIndex - 1 + cards.length) % cards.length;
  atualizarCarrossel();
});
btnNext.addEventListener("click", () => {
  const cards = document.querySelectorAll(".card");
  if (cards.length === 0) return;
  currentIndex = (currentIndex + 1) % cards.length;
  atualizarCarrossel();
});
  </script>
</body>
</html>